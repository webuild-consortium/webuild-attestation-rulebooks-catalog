{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/schemas/ds005-hello-world-mdoc.json",
  "title": "ds005 - Hello World Attestation (HWA) - ISO/IEC 18013-5 mdoc",
  "description": "Schema for the mdoc issuance representation of the Hello World Attestation (HWA) as defined in the ds005 rulebook. This models the issuerSigned structure and namespace attributes. Note: Actual mdoc credentials use CBOR encoding; this JSON Schema documents the attribute structure and constraints.",
  "type": "object",
  "version": "1.0.0",
  "$defs": {
    "cddl_tstr": {
      "type": "string",
      "description": "CDDL tstr: UTF-8 text string, max 150 characters per rulebook.",
      "maxLength": 150
    },
    "cddl_uint": {
      "type": "integer",
      "description": "CDDL uint: unsigned integer.",
      "minimum": 0
    },
    "issuer_signed_item": {
      "type": "object",
      "description": "Issuer-signed namespace item with element identifier and value.",
      "additionalProperties": false,
      "properties": {
        "elementIdentifier": {
          "type": "string",
          "enum": [
            "message",
            "attestation_legal_category",
            "issuing_authority",
            "issuer_legal_id",
            "trust_anchor_url",
            "attestation_scheme"
          ]
        },
        "elementValue": {
          "type": "string"
        }
      },
      "required": ["elementIdentifier", "elementValue"],
      "allOf": [
        {
          "if": {
            "properties": { "elementIdentifier": { "const": "message" } },
            "required": ["elementIdentifier"]
          },
          "then": {
            "properties": { "elementValue": { "type": "string", "const": "Hello World!" } }
          }
        },
        {
          "if": {
            "properties": { "elementIdentifier": { "const": "attestation_legal_category" } },
            "required": ["elementIdentifier"]
          },
          "then": {
            "properties": { "elementValue": { "type": "string", "const": "QEAA" } }
          }
        },
        {
          "if": {
            "properties": { "elementIdentifier": { "const": "issuing_authority" } },
            "required": ["elementIdentifier"]
          },
          "then": {
            "properties": { "elementValue": { "type": "string", "format": "uri" } }
          }
        },
        {
          "if": {
            "properties": { "elementIdentifier": { "const": "issuer_legal_id" } },
            "required": ["elementIdentifier"]
          },
          "then": {
            "properties": { "elementValue": { "$ref": "#/$defs/cddl_tstr" } }
          }
        },
        {
          "if": {
            "properties": { "elementIdentifier": { "const": "trust_anchor_url" } },
            "required": ["elementIdentifier"]
          },
          "then": {
            "properties": { "elementValue": { "type": "string", "format": "uri" } }
          }
        },
        {
          "if": {
            "properties": { "elementIdentifier": { "const": "attestation_scheme" } },
            "required": ["elementIdentifier"]
          },
          "then": {
            "properties": { "elementValue": { "type": "string", "const": "QEAA:HelloWorld" } }
          }
        }
      ]
    },
    "namespace_items": {
      "type": "array",
      "description": "Namespace items for HWA issuance; order is not significant.",
      "items": { "$ref": "#/$defs/issuer_signed_item" },
      "minItems": 6,
      "allOf": [
        {
          "contains": {
            "type": "object",
            "properties": {
              "elementIdentifier": { "const": "message" },
              "elementValue": { "const": "Hello World!" }
            },
            "required": ["elementIdentifier", "elementValue"]
          },
          "minContains": 1
        },
        {
          "contains": {
            "type": "object",
            "properties": {
              "elementIdentifier": { "const": "attestation_legal_category" },
              "elementValue": { "const": "QEAA" }
            },
            "required": ["elementIdentifier", "elementValue"]
          },
          "minContains": 1
        },
        {
          "contains": {
            "type": "object",
            "properties": {
              "elementIdentifier": { "const": "issuing_authority" }
            },
            "required": ["elementIdentifier"]
          },
          "minContains": 1
        },
        {
          "contains": {
            "type": "object",
            "properties": {
              "elementIdentifier": { "const": "issuer_legal_id" }
            },
            "required": ["elementIdentifier"]
          },
          "minContains": 1
        },
        {
          "contains": {
            "type": "object",
            "properties": {
              "elementIdentifier": { "const": "trust_anchor_url" }
            },
            "required": ["elementIdentifier"]
          },
          "minContains": 1
        },
        {
          "contains": {
            "type": "object",
            "properties": {
              "elementIdentifier": { "const": "attestation_scheme" },
              "elementValue": { "const": "QEAA:HelloWorld" }
            },
            "required": ["elementIdentifier", "elementValue"]
          },
          "minContains": 1
        }
      ]
    }
  },
  "properties": {
    "docType": {
      "type": "string",
      "const": "eu.webuildconsortium.helloworld.v1",
      "description": "Document type identifier for the Hello World Attestation."
    },
    "issuerSigned": {
      "type": "object",
      "description": "Issuer-signed structure containing namespace attributes, validityInfo, and issuerAuth.",
      "additionalProperties": false,
      "properties": {
        "nameSpaces": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "eu.webuildconsortium.helloworld.v1": {
              "$ref": "#/$defs/namespace_items"
            }
          },
          "required": ["eu.webuildconsortium.helloworld.v1"]
        },
        "validityInfo": {
          "type": "object",
          "description": "Validity information in epoch seconds; source of truth for validity.",
          "additionalProperties": false,
          "properties": {
            "signed": { "$ref": "#/$defs/cddl_uint" },
            "validFrom": { "$ref": "#/$defs/cddl_uint" },
            "validUntil": { "$ref": "#/$defs/cddl_uint" }
          },
          "required": ["signed", "validFrom", "validUntil"]
        },
        "issuerAuth": {
          "type": "string",
          "description": "COSE_Sign1 structure for issuer authentication (encoded as a string in this JSON representation)."
        }
      },
      "required": ["nameSpaces", "validityInfo", "issuerAuth"]
    }
  },
  "required": ["docType", "issuerSigned"],
  "additionalProperties": false,
  "$comment": "This schema models the ds005 mdoc issuance example. It does not enforce validityInfo temporal relationships; enforce in implementation."
}
